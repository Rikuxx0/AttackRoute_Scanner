# AttackRoute_Scanner

本ツールは、Draw.ioで定義されたシステム構成図、Nuclei/Niktoによる脆弱性診断結果、および手動マッピング情報を自動で統合し、潜在的な攻撃経路とシステムリスクを可視化するためのプロトタイプです。

## 主な特徴
- **攻撃経路の可視化**: システム構成と脆弱性情報から攻撃経路を推論し、`NetworkX` + `Pyvis` を用いてインタラクティブなグラフとして表示します。
- **リスクスコアの算出**: ノード（資産）ごとに以下の指標を統合し、定量的なリスクスコアを算出します。
  - `Vuln_Count`: ノードに存在する脆弱性の数
  - `Severity`: 脆弱性の平均深刻度
  - `Importance`: 事前定義されたノードの重要度
  - `proximity`: 外部侵入口からの近接性
- **対話的な分析**: UI上で侵入口や重要ノードを手動で指定し、異なるシナリオに基づいたリスク分析が可能です。
- **柔軟なマッピング**: Draw.io上のノード名と脆弱性レポートのホスト名を、手動マッピングファイル（JSON）を用いて柔軟に紐付けできます。

## 処理フロー
1.  **入力ファイルの解析**: アップロードされたDraw.io(XML)、脆弱性診断レポート(TXT)、手動マッピングファイル(JSON)をそれぞれ解析します。
2.  **グラフの構築**: Draw.ioのデータから、システムのノードと接続関係を持つ有向グラフを生成します。
3.  **脆弱性情報の集約**: 複数の脆弱性レポートを読み込み、ホストごとに脆弱性件数（`Vuln_Count`）と平均深刻度（`Severity`）を集計します。
4.  **データ統合**: 手動マッピングファイルとノード名の自動照合ロジックに基づき、集約した脆弱性情報をグラフ上の各ノードに付与します。
5.  **リスク算出と経路探索**: 各ノードの「重要度」や「侵入口からの近接性」を計算し、最終的な「リスクスコア」を算出します。その後、侵入口から重要ノードまでの最短攻撃経路を探索します。
6.  **結果の可視化**: 算出されたリスクスコア、ノード情報、攻撃経路をStreamlitの画面上にテーブルとインタラクティブなグラフで表示します。
7.  **可視化結果のリスク評価の説明**: リスクスコア、脆弱性診断レポート、攻撃パスにより、現実的な攻撃シナリオを説明します。

## インストール
必要なPythonライブラリをインストールします。
```bash
pip install streamlit pandas networkx pyvis google.generativeai
```

## 使い方
1.  リポジトリをクローンし、上記のコマンドで依存ライブラリをインストールします。
2.  以下のコマンドでStreamlitアプリケーションを起動します。
    ```bash
    streamlit run app.py
    ```
3.  Webブラウザでアプリケーションが開いたら、以下の3種類のファイルをアップロードします。
    - **Draw.ioのXMLファイル**: `.drawio`または`.xml`形式のファイル。
    - **脆弱性レポート**: NucleiまたはNiktoによってTXT形式で出力されたレポート（複数可）。
    - **手動マッピングファイル**: Draw.io上のノード名とレポート上のホスト名（IP:Port）を紐付けるJSONファイル。
4.  ファイルがすべてアップロードされると、自動的に解析が開始されます。
5.  画面に表示された統合ノード情報、攻撃パス、およびインタラクティブなグラフを確認します。

## Demo動画
Gemini APIの制限上、途中までのレポートしか出力されていませんが、リポジトリ内にあります


### `manual_mapping.json`の記述例
Draw.io上のラベル名（例: "OWASP juice-shop"）と、脆弱性レポートに記載されているホスト名（例: "localhost:3000"）をマッピングします。

```json
{
  "vuln-api": "localhost:5000",
  "OWASP juice-shop": "localhost:3000"
}
```

### JSON出力結果のサンプル例
各ノードに対して、以下のような情報が算出されます（このJSONは内部データであり、直接出力されるわけではありません）。

```json
{
  "label": "vuln-api",
  "Vuln_Count": 12,
  "Severity": 2.3,
  "proximity": 0.52,
  "Importance": 2.0,
  "Risk_Score": 24.96
}
```
*このREADMEは、[Notionの参考資料](https://www.notion.so/28b52696249280ad8634ca451f4b7fb4?pvs=74)を基に作成されています。*
